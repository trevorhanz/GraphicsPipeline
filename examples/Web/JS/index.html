<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>

    <!-- Create the canvas that the C++ code will draw into -->
    <canvas id="canvas1" oncontextmenu="event.preventDefault()"></canvas>
    <canvas id="canvas2" oncontextmenu="event.preventDefault()"></canvas>
    
    <!-- Call the javascript glue code (EM.js) as generated by Emscripten -->
    <script src="GP.js"></script>
    
    <!-- Allow the javascript to call C++ functions -->
    <script type='text/javascript'>
        // Shader sources
        vertexSource =
`attribute vec4 position;
void main()
{
  gl_Position = vec4(position.xyz, 1.0);
}`;
        fragmentSource =
`precision mediump float;
void main()
{
  gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
}`;
        var pipeline = null;
        
        var start = null;
        function step(timestamp) {
          pipeline.Execute();
          window.requestAnimationFrame(step);
        }
        
        window.onload = () => {
          Module.onRuntimeInitialized = () => {
              var GP = {};
              GP.Target = Module.Target;
              GP.Context = Module.Context;
              
              console.log(Module);
              var context = new GP.Context();
              var canv1 = new GP.Target("#canvas1");
              var canv2 = new GP.Target("#canvas2");
              
              array = new Module.Array();
              shader = new Module.Shader();
              
              targetFocus = new Module.TargetFocus();
              targetFocus.SetTarget(canv1);
              
              loadPipe = context.CreatePipeline();
              loadPipe.AddOperation(targetFocus);
              loadArray = new Module.LoadArray();
              loadArray.SetArray(array);
              loadPipe.AddOperation(loadArray);
              loadShader = new Module.LoadShader();
              loadShader.SetShader(shader);
              loadShader.SetVertexCode(vertexSource);
              loadShader.SetFragmentCode(fragmentSource);
              loadPipe.AddOperation(loadShader);
              loadPipe.Execute();
              
              pipeline = context.CreatePipeline();
              pipeline.AddOperation(targetFocus);
              draw = new Module.Draw();
              draw.SetShader(shader);
              draw.SetArray(array);
              pipeline.AddOperation(draw);
              
              window.requestAnimationFrame(step);
            };
        };
    </script>

</body>

</html>
